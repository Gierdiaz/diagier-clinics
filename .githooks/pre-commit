#!/bin/bash

# Rodar gofmt em todos os arquivos Go e verificar se há arquivos que precisam de formatação
echo "Checking Go file formatting..."
unformatted_files=$(gofmt -l ./...)

# Se não houver arquivos não formatados, apenas informar
if [ -z "$unformatted_files" ]; then
  echo "All Go files are properly formatted."
else
  echo "Running gofmt on unformatted files..."
  gofmt -w $unformatted_files  # Aplica a formatação
  if [ $? -ne 0 ]; then
    echo "gofmt failed. Please fix the formatting issues."
    exit 1
  fi
  echo "Formatted the following files:"
  echo "$unformatted_files"
fi

# Rodar testes da pasta test
echo "Running go tests..."
go test ./test/...

# Se algum teste falhar, o commit é cancelado
if [ $? -ne 0 ]; then
  echo "Some tests failed. Please fix the errors."
  exit 1
fi

echo "All tests passed."
